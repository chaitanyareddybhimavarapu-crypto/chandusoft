# Enable the Rewrite Engine
RewriteEngine On
RewriteBase /

# ✅ Force Redirect HTTP ➝ HTTPS (safe for ngrok/proxies)
# Only redirect if BOTH:
#   1. HTTPS is off
#   2. X-Forwarded-Proto (used by proxies/ngrok) is not https
RewriteCond %{HTTPS} !=on
RewriteCond %{HTTP:X-Forwarded-Proto} !https
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# ✅ Allow Stripe Webhook & other real PHP files to run directly
RewriteCond %{REQUEST_FILENAME} -f
RewriteCond %{REQUEST_URI} \.php$ [NC]
RewriteRule ^ - [L]

# ✅ Remove "index.php?page=" from URLs
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^([a-zA-Z0-9_-]+)$ index.php?page=$1 [QSA,L]

# ✅ Custom 404 Page
ErrorDocument 404 /404.php
